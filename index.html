 <!DOCTYPE html>
<html>
  <head>
    <title>CityGuesser</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {height: 100%; width:100%;}
      #places {height:0;width:0;opacity:0;}
      /* Optional: Makes the sample page fill the window. */
      html, body {height: 95%; margin: 0; padding: 0;}

    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWHTnGlByt3KMI3QraQwn50cwUHAA4pc0"
    async defer></script>

  </head>
  <body>
    <h3>City Guesser</h3>
    <div id="score"> </div>
    <div id="message"> </div>

    <form action="" id=guessform>
     <input id="guess" type="text" placeholder="Guess a City" name="Guess a City">
     <a id="guessbutton" href="#" onclick="makeGuess();">Guess</a>
    </form>

    <input id="hint" type="button" value="hint" align="right" onclick="giveHint();">

    <object id="places" data="places.json"></object>
    <div id="map"></div>
    <script>
      var map;
      var latlongs;
      var randomCity;
      var minZoomLevel = 15;
      var points = 0;
      var usedNumbers = [];
      var num;
      var hints=0;
      var strikes = 0;

      function getRandomInt(max) {
        num = Math.floor(Math.random() * Math.floor(max));
        if (usedNumbers.includes(num)){
          return getRandomInt(max);
        }
        else{
          if (usedNumbers.length == latlongs.length){
            usedNumbers = []
          }
          else{
            usedNumbers.push(num)
            return num
          }
        }
      }

      document.getElementById("score").innerHTML = "Points: " + points;
      var object = document.getElementById("places");

      function makeGuess() {
        var guess = document.getElementById("guess").value;
        if (guess.toLowerCase().trim() === randomCity.name.toLowerCase().trim()){
          points = points + 10;
          document.getElementById("message").innerHTML = "That's right!!!!";
          document.getElementById("score").innerHTML = "Points: " + points;

        }
        else {
          document.getElementById("message").innerHTML = "Nope. The answer was " + randomCity.name;
          document.getElementById("score").innerHTML = "Points: " + points;
          strikes ++;
          if (strikes == 3){
            gameOver();
          }
        }
        document.getElementById("guess").value = "";
        object.onload();
      }

      object.onload = function() {
        latlongs = eval(object.contentDocument.body.childNodes[0].innerHTML);
        randomCity = latlongs[getRandomInt(latlongs.length)];
        initMap();
      };

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: randomCity.lat, lng: randomCity.lng},
          zoom: minZoomLevel,
          mapTypeId: 'satellite',
          disableDefaultUI: true
        })
          google.maps.event.addListener(map, 'zoom_changed', function() {
          if (map.getZoom() < minZoomLevel) map.setZoom(minZoomLevel);
          });;
        }

        document.getElementById('guess').onkeydown = function(event) {
            if (event.keyCode == 13) {
              makeGuess();
              return event.keyCode != 13;
            }
        }

      function giveHint(){
          if (hints == 0){
          points = points - 5;
          alert("This place is in the " + randomCity.hemisphere + " hemisphere.");
          }

          else if (hints == 1) {
          points = points - 10
          alert("This place is in the continent of " + randomCity.continent + ".");
          }

          else if (hints == 2) {
          points = points - 15
          alert("This place is in " + randomCity.country + ".");
          }

          else if (hints > 2){
          alert("Sorry. No more hints.");
          }
          document.getElementById("score").innerHTML = "Points: " + points;
          hints ++;
        }

      function gameOver(){
        alert("GAME OVER! Your final score is " + points)
        location.reload();
      }

    </script>

  </body>
</html>
